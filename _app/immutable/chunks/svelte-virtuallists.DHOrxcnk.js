var oe=Object.defineProperty;var ae=(s,e,t)=>e in s?oe(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var I=(s,e,t)=>ae(s,typeof e!="symbol"?e+"":e,t);import{p as re,a as x,s as D,b as C,u as H,o as le,c as de,g as S,d as g,e as he,i as p,f as fe,t as me,h as V,j as ue,k as ce,l as Se,m as $,n as ze,q as Z,r as B,v as L,w as U,x as J}from"./external.DvB2ine7.js";class Ie{constructor(e,t,n,r){I(this,"items");I(this,"itemSize");I(this,"itemCount");I(this,"estimatedItemSize");I(this,"itemSizeAndPositionData");I(this,"lastMeasuredIndex");I(this,"totalSize");this.items=e,this.itemSize=t,this.itemCount=n,this.estimatedItemSize=r,this.itemSizeAndPositionData={},this.lastMeasuredIndex=-1,this.checkForMismatchItemSizeAndItemCount(),this.justInTime||this.computeTotalSizeAndPositionData()}get justInTime(){return typeof this.itemSize=="function"}updateConfig(e,t,n){t!==void 0&&(this.itemCount=t),n!==void 0&&(this.estimatedItemSize=n),e!==void 0&&(this.itemSize=e),this.checkForMismatchItemSizeAndItemCount(),this.justInTime&&this.totalSize!==void 0?this.totalSize=void 0:this.computeTotalSizeAndPositionData()}checkForMismatchItemSizeAndItemCount(){if(Array.isArray(this.itemSize)&&this.itemSize.length<this.itemCount)throw Error("When itemSize is an array, itemSize.length can't be smaller than itemCount")}getSize(e){const{itemSize:t}=this;return typeof t=="function"?t(this.items[e],e):Array.isArray(t)?t[e]:t}computeTotalSizeAndPositionData(){let e=0;for(let t=0;t<this.itemCount;t++){const n=this.getSize(t),r=e;e+=n,this.itemSizeAndPositionData[t]={offset:r,size:n}}this.totalSize=e}getLastMeasuredIndex(){return this.lastMeasuredIndex}getSizeAndPositionForIndex(e){if(e<0||e>=this.itemCount)throw Error(`Requested index ${e} is outside of range 0..${this.itemCount}`);return this.justInTime?this.getJustInTimeSizeAndPositionForIndex(e):this.itemSizeAndPositionData[e]}getJustInTimeSizeAndPositionForIndex(e){if(e>this.lastMeasuredIndex){const t=this.getSizeAndPositionOfLastMeasuredItem();let n=t.offset+t.size;for(let r=this.lastMeasuredIndex+1;r<=e;r++){const a=this.getSize(r);if(a===void 0||isNaN(a))throw Error(`Invalid size returned for index ${r} of value ${a}`);this.itemSizeAndPositionData[r]={offset:n,size:a},n+=a}this.lastMeasuredIndex=e}return this.itemSizeAndPositionData[e]}getSizeAndPositionOfLastMeasuredItem(){return this.lastMeasuredIndex>=0?this.itemSizeAndPositionData[this.lastMeasuredIndex]:{offset:0,size:0}}getEstimatedItemSize(){return this.estimatedItemSize||typeof this.itemSize=="number"&&this.itemSize||50}getTotalSize(){if(this.totalSize)return this.totalSize;const e=this.getSizeAndPositionOfLastMeasuredItem();return e.offset+e.size+(this.itemCount-this.lastMeasuredIndex-1)*this.getEstimatedItemSize()}getUpdatedOffsetForIndex(e=M.START,t,n,r){if(t<=0)return 0;const a=this.getSizeAndPositionForIndex(r),l=a.offset,T=l-t+a.size;let d;switch(e){case M.END:d=T;break;case M.CENTER:d=l-(t-a.size)/2;break;case M.START:d=l;break;default:d=Math.max(T,Math.min(l,n))}const P=this.getTotalSize();return Math.max(0,Math.min(P-t,d))}getVisibleRange(e=0,t,n){if(this.getTotalSize()===0)return{start:0,end:0};const a=t+e;let l=this.findNearestItem(t);if(l===void 0)throw Error(`Invalid offset ${t} specified`);const T=this.getSizeAndPositionForIndex(l);t=T.offset+T.size;let d=l;for(;t<a&&d<this.itemCount-1;)d++,t+=this.getSizeAndPositionForIndex(d).size;return n&&(l=Math.max(0,l-n),d=Math.min(d+n,this.itemCount-1)),{start:l,end:d}}resetItem(e){this.lastMeasuredIndex=Math.min(this.lastMeasuredIndex,e-1)}findNearestItem(e){if(isNaN(e))throw Error(`Invalid offset ${e} specified`);e=Math.max(0,e);const t=this.getSizeAndPositionOfLastMeasuredItem(),n=Math.max(0,this.lastMeasuredIndex);return t.offset>=e?this.binarySearch(0,n,e):this.exponentialSearch(n,e)}binarySearch(e,t,n){let r=0,a=0;for(;e<=t;){if(r=e+Math.floor((t-e)/2),a=this.getSizeAndPositionForIndex(r).offset,a===n)return r;a<n?e=r+1:a>n&&(t=r-1)}return e>0?e-1:0}exponentialSearch(e,t){let n=1;for(;e<this.itemCount&&this.getSizeAndPositionForIndex(e).offset<t;)e+=n,n*=2;return this.binarySearch(Math.floor(e/2),Math.min(e,this.itemCount-1),t)}}var ge=ce('<div class="virtual-list-wrapper svelte-1qhxbsx"><!> <div class="virtual-list-inner svelte-1qhxbsx"></div> <!></div>');const Te=(()=>{let s=!1;try{const e=Object.defineProperty({},"passive",{get(){return s={passive:!0},!0}});window.addEventListener("testpassive",e,e),window.remove("testpassive",e,e)}catch{}return s})();function xe(s,e){re(e,!0);const t=x(e,"width",3,"100%"),n=x(e,"items",11,()=>[]),r=x(e,"windowOverPadding",3,3),a=x(e,"scrollDirection",11,()=>f.VERTICAL),l=x(e,"scrollToAlignment",11,()=>M.AUTO),T=x(e,"scrollToBehaviour",11,()=>ee.INSTANT),d={[f.VERTICAL]:"top",[f.HORIZONTAL]:"left"},P={[f.VERTICAL]:"scrollTop",[f.HORIZONTAL]:"scrollLeft"},v=new Ie(n(),e.itemSize,e.itemCount,e.estimatedItemSize);let O=!1,m,K=D(C([])),u=D(C({offset:e.scrollOffset||e.scrollToIndex!==void 0&&e.itemCount&&N(e.scrollToIndex)||0,scrollChangeReason:E.REQUESTED})),b={},A={scrollToIndex:e.scrollToIndex,scrollToAlignment:l(),scrollOffset:e.scrollOffset,itemCount:e.itemCount,itemSize:e.itemSize,estimatedItemSize:e.estimatedItemSize},y={},F=D(""),k=D("");H(()=>{e.scrollToIndex,l(),e.scrollOffset,e.itemCount,e.itemSize,e.estimatedItemSize,te()}),H(()=>{S(u),ie()}),H(()=>{e.height,t(),O&&Q(0)}),(()=>{if(a()===f.VERTICAL&&typeof e.height!="number")throw new Error("virtual list's height must be a number when scrollDirection is 'vertical'");if(a()===f.HORIZONTAL&&typeof t()!="number")throw new Error("virtual list's width must be a number if scrollDirection is 'horizontal'");_()})(),le(()=>{m.addEventListener("scroll",W,Te),e.scrollOffset!==void 0?j(e.scrollOffset):e.scrollToIndex!==void 0&&j(N(e.scrollToIndex)),O=!0}),de(()=>{O&&m.removeEventListener("scroll",W)});function te(){if(!O)return;e.scrollToIndex&&e.scrollOffset&&console.log("VirtualList: scrollToIndex and scrollOffset shall not be used together.");const i=A.scrollToIndex!==e.scrollToIndex||A.scrollToAlignment!==l(),o=A.itemCount!==e.itemCount||A.itemSize!==e.itemSize||A.estimatedItemSize!==e.estimatedItemSize;o&&(v.updateConfig(e.itemSize,e.itemCount,e.estimatedItemSize),Q()),A.scrollOffset!==e.scrollOffset?g(u,C({offset:e.scrollOffset||0,scrollChangeReason:E.REQUESTED})):typeof e.scrollToIndex=="number"&&(i||o)&&g(u,C({offset:N(e.scrollToIndex,l(),e.itemCount),scrollChangeReason:E.REQUESTED})),A={scrollToIndex:e.scrollToIndex,scrollToAlignment:l(),scrollOffset:e.scrollOffset,itemCount:e.itemCount,itemSize:e.itemSize,estimatedItemSize:e.estimatedItemSize}}function ie(){if(!O)return;const{offset:i,scrollChangeReason:o}=S(u);(b.offset!==i||b.scrollChangeReason!==o)&&_(),b.offset!==i&&o===E.REQUESTED&&j(i),b=S(u)}function _(){const{offset:i}=S(u);let{start:o,end:h}=v.getVisibleRange(a()===f.VERTICAL?e.height:t(),i,r()),c=[];const w=v.getTotalSize(),X=typeof e.height=="number"?"px":"",G=typeof t()=="number"?"px":"";if(a()===f.VERTICAL?(g(F,`height:${e.height}${X};width:${t()}${G};`),g(k,`flex-direction:column;height:${w}px;`)):(g(F,`height:${e.height}${X};width:${t()}${G};`),g(k,`min-height:100%;width:${w}px;`)),o!==void 0&&h!==void 0){for(let z=o;z<=h;z++)c.push({item:n()[z],index:z,style:se(z)});if(e.onVisibleRangeUpdate){const z=v.getVisibleRange(a()===f.VERTICAL?e.height:t(),i,0);e.onVisibleRangeUpdate({type:"range.update",start:z.start,end:z.end})}}g(K,C(c))}function j(i){"scroll"in m?m.scroll({[d[a()]]:i,behavior:T()}):m[P[a()]]=i}function Q(i=0){y={},v.resetItem(i),_()}function N(i,o=l(),h=e.itemCount){return i<0?i=0:i>=h&&(i=h-1),v.getUpdatedOffsetForIndex(o,a()===f.VERTICAL?e.height:t(),S(u).offset||0,i)}const W=i=>{const o=m[P[a()]];o<0||S(u).offset===o||i.target!==m||(g(u,C({offset:o,scrollChangeReason:E.OBSERVED})),e.onAfterScroll&&e.onAfterScroll({type:"scroll.update",offset:o,event:i}))};function se(i){if(y[i])return y[i];const{size:o,offset:h}=v.getSizeAndPositionForIndex(i);let c;return a()===f.VERTICAL?c=`left:0;width:100%;height:${o}px;position:absolute;top:${h}px;`:c=`top:0;width:${o}px;position:absolute;height:100%;left:${h}px;`,y[i]=c}var R=ge();he(R,i=>m=i,()=>m);var Y=ze(R);p(Y,()=>e.header,i=>{var o=Z(),h=J(o);B(()=>e.header,h),V(i,o)});var q=L(L(Y,!0));fe(q,73,()=>S(K),Se,(i,o,h)=>{var c=Z(),w=J(c);B(()=>e.slot,w,()=>({item:U(o).item,style:U(o).style,index:e.getKey?e.getKey(U(o).index):U(o).index})),V(i,c)});var ne=L(L(q,!0));return p(ne,()=>e.footer,i=>{var o=Z(),h=J(o);B(()=>e.footer,h),V(i,o)}),me(()=>{$(R,"style",S(F)),$(q,"style",S(k))}),V(s,R),ue({recomputeSizes:Q})}var ee=(s=>(s.AUTO="auto",s.SMOOTH="smooth",s.INSTANT="instant",s))(ee||{}),M=(s=>(s.AUTO="auto",s.START="start",s.CENTER="center",s.END="end",s))(M||{}),f=(s=>(s.HORIZONTAL="horizontal",s.VERTICAL="vertical",s))(f||{}),E=(s=>(s[s.OBSERVED=0]="OBSERVED",s[s.REQUESTED=1]="REQUESTED",s))(E||{});export{M as A,f as D,ee as S,xe as V};
