var le=Object.defineProperty;var re=(s,e,t)=>e in s?le(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var g=(s,e,t)=>re(s,typeof e!="symbol"?e+"":e,t);import{p as de,a as I,s as D,b as C,u as Q,o as he,c as fe,g as f,d as T,e as me,i as p,f as ce,t as ue,h as V,j as Se,k as ze,l as $,m as ge,n as Ie,r as ee,q as Te,v as ve,w as Ae,x as B,y as H,z as Z,A as xe}from"./external.ClML6rh5.js";class Ce{constructor(e,t,n,l){g(this,"model");g(this,"modelCount");g(this,"itemSize");g(this,"estimatedItemSize");g(this,"itemSizeAndPositionData");g(this,"lastMeasuredIndex");g(this,"totalSize");this.model=e,this.itemSize=n,this.modelCount=t,this.estimatedItemSize=l,this.itemSizeAndPositionData={},this.lastMeasuredIndex=-1,this.checkForMismatchItemSizeAndItemCount(),this.justInTime||this.computeTotalSizeAndPositionData()}get justInTime(){return typeof this.itemSize=="function"}updateConfig(e,t,n){t!==void 0&&(this.modelCount=t),n!==void 0&&(this.estimatedItemSize=n),e!==void 0&&(this.itemSize=e),this.checkForMismatchItemSizeAndItemCount(),this.justInTime&&this.totalSize!==void 0?this.totalSize=void 0:this.computeTotalSizeAndPositionData()}checkForMismatchItemSizeAndItemCount(){if(Array.isArray(this.itemSize)&&this.itemSize.length<this.modelCount)throw Error("When itemSize is an array, itemSize.length can't be smaller than itemCount")}getSize(e){const{itemSize:t}=this;return typeof t=="function"?t(this.model[e],e):Array.isArray(t)?t[e]:t}computeTotalSizeAndPositionData(){let e=0;for(let t=0;t<this.modelCount;t++){const n=this.getSize(t),l=e;e+=n,this.itemSizeAndPositionData[t]={offset:l,size:n}}this.totalSize=e}getLastMeasuredIndex(){return this.lastMeasuredIndex}getSizeAndPositionForIndex(e){if(e<0||e>=this.modelCount)throw Error(`Requested index ${e} is outside of range 0..${this.modelCount}`);return this.justInTime?this.getJustInTimeSizeAndPositionForIndex(e):this.itemSizeAndPositionData[e]}getJustInTimeSizeAndPositionForIndex(e){if(e>this.lastMeasuredIndex){const t=this.getSizeAndPositionOfLastMeasuredItem();let n=t.offset+t.size;for(let l=this.lastMeasuredIndex+1;l<=e;l++){const a=this.getSize(l);if(a===void 0||isNaN(a))throw Error(`Invalid size returned for index ${l} of value ${a}`);this.itemSizeAndPositionData[l]={offset:n,size:a},n+=a}this.lastMeasuredIndex=e}return this.itemSizeAndPositionData[e]}getSizeAndPositionOfLastMeasuredItem(){return this.lastMeasuredIndex>=0?this.itemSizeAndPositionData[this.lastMeasuredIndex]:{offset:0,size:0}}getEstimatedItemSize(){return this.estimatedItemSize||typeof this.itemSize=="number"&&this.itemSize||50}getTotalSize(){if(this.totalSize)return this.totalSize;const e=this.getSizeAndPositionOfLastMeasuredItem();return e.offset+e.size+(this.modelCount-this.lastMeasuredIndex-1)*this.getEstimatedItemSize()}getUpdatedOffsetForIndex(e=y.START,t,n,l){if(t<=0)return 0;const a=this.getSizeAndPositionForIndex(l),r=a.offset,v=r-t+a.size;let h;switch(e){case y.END:h=v;break;case y.CENTER:h=r-(t-a.size)/2;break;case y.START:h=r;break;default:h=Math.max(v,Math.min(r,n))}const U=this.getTotalSize();return Math.max(0,Math.min(U-t,h))}getVisibleRange(e=0,t,n){if(this.getTotalSize()===0)return{start:0,end:0};const a=t+e;let r=this.findNearestItem(t);if(r===void 0)throw Error(`Invalid offset ${t} specified`);const v=this.getSizeAndPositionForIndex(r);t=v.offset+v.size;let h=r;for(;t<a&&h<this.modelCount-1;)h++,t+=this.getSizeAndPositionForIndex(h).size;return n&&(r=Math.max(0,r-n),h=Math.min(h+n,this.modelCount-1)),{start:r,end:h}}resetItem(e){this.lastMeasuredIndex=Math.min(this.lastMeasuredIndex,e-1)}findNearestItem(e){if(isNaN(e))throw Error(`Invalid offset ${e} specified`);e=Math.max(0,e);const t=this.getSizeAndPositionOfLastMeasuredItem(),n=Math.max(0,this.lastMeasuredIndex);return t.offset>=e?this.binarySearch(0,n,e):this.exponentialSearch(n,e)}binarySearch(e,t,n){let l=0,a=0;for(;e<=t;){if(l=e+Math.floor((t-e)/2),a=this.getSizeAndPositionForIndex(l).offset,a===n)return l;a<n?e=l+1:a>n&&(t=l-1)}return e>0?e-1:0}exponentialSearch(e,t){let n=1;for(;e<this.modelCount&&this.getSizeAndPositionForIndex(e).offset<t;)e+=n,n*=2;return this.binarySearch(Math.floor(e/2),Math.min(e,this.modelCount-1),t)}}const Ee=(()=>{let s=!1;try{const e=Object.defineProperty({},"passive",{get(){return s={passive:!0},!0}});window.addEventListener("testpassive",e,e),window.remove("testpassive",e,e)}catch{}return s})();var ye=ze('<div><!> <div class="virtual-list-inner svelte-f32i87"></div> <!></div>');function Pe(s,e){de(e,!0);const t=I(e,"width",3,"100%"),n=I(e,"model",19,()=>[]),l=I(e,"windowOverPadding",3,3),a=I(e,"scrollDirection",19,()=>m.VERTICAL),r=I(e,"scrollToAlignment",19,()=>y.AUTO),v=I(e,"scrollToBehaviour",19,()=>te.INSTANT),h=I(e,"class",3,"");I(e,"style",3,"");const U=Ae(e,["$$slots","$$events","$$legacy","height","width","model","modelCount","itemSize","estimatedItemSize","getKey","scrollToIndex","scrollOffset","windowOverPadding","scrollDirection","scrollToAlignment","scrollToBehaviour","footer","slot","header","onVisibleRangeUpdate","onAfterScroll","class","style"]),ie={[m.VERTICAL]:"top",[m.HORIZONTAL]:"left"},q={[m.VERTICAL]:"scrollTop",[m.HORIZONTAL]:"scrollLeft"},A=new Ce(n(),e.modelCount,e.itemSize,e.estimatedItemSize);let O=!1,c,K=D(C([])),u=D(C({offset:e.scrollOffset||e.scrollToIndex!==void 0&&e.modelCount&&N(e.scrollToIndex)||0,scrollChangeReason:E.REQUESTED})),P={},x={scrollToIndex:e.scrollToIndex,scrollToAlignment:r(),scrollOffset:e.scrollOffset,modelCount:e.modelCount,itemSize:e.itemSize,estimatedItemSize:e.estimatedItemSize},b={},L=D(""),F=D("");Q(()=>{e.scrollToIndex,r(),e.scrollOffset,e.modelCount,e.itemSize,e.estimatedItemSize,se()}),Q(()=>{f(u),ne()}),Q(()=>{e.height,t(),O&&j(0)}),(()=>{if(a()===m.VERTICAL&&typeof e.height!="number")throw new Error("virtual list's height must be a number when scrollDirection is 'vertical'");if(a()===m.HORIZONTAL&&typeof t()!="number")throw new Error("virtual list's width must be a number if scrollDirection is 'horizontal'");_()})(),he(()=>{c.addEventListener("scroll",J,Ee),e.scrollOffset!==void 0?k(e.scrollOffset):e.scrollToIndex!==void 0&&k(N(e.scrollToIndex)),O=!0}),fe(()=>{O&&c.removeEventListener("scroll",J)});function se(){if(!O)return;e.scrollToIndex&&e.scrollOffset&&console.log("VirtualList: scrollToIndex and scrollOffset shall not be used together.");const i=x.scrollToIndex!==e.scrollToIndex||x.scrollToAlignment!==r(),o=x.modelCount!==e.modelCount||x.itemSize!==e.itemSize||x.estimatedItemSize!==e.estimatedItemSize;o&&(A.updateConfig(e.itemSize,e.modelCount,e.estimatedItemSize),j()),x.scrollOffset!==e.scrollOffset?T(u,C({offset:e.scrollOffset||0,scrollChangeReason:E.REQUESTED})):typeof e.scrollToIndex=="number"&&(i||o)&&T(u,C({offset:N(e.scrollToIndex,r(),e.modelCount),scrollChangeReason:E.REQUESTED})),x={scrollToIndex:e.scrollToIndex,scrollToAlignment:r(),scrollOffset:e.scrollOffset,modelCount:e.modelCount,itemSize:e.itemSize,estimatedItemSize:e.estimatedItemSize}}function ne(){if(!O)return;const{offset:i,scrollChangeReason:o}=f(u);(P.offset!==i||P.scrollChangeReason!==o)&&_(),P.offset!==i&&o===E.REQUESTED&&k(i),P=f(u)}function _(){const{offset:i}=f(u);let{start:o,end:d}=A.getVisibleRange(a()===m.VERTICAL?e.height:t(),i,l()),S=[];const w=A.getTotalSize(),X=typeof e.height=="number"?"px":"",G=typeof t()=="number"?"px":"";if(a()===m.VERTICAL?(T(L,`height:${e.height}${X};width:${t()}${G};`),T(F,`flex-direction:column;height:${w}px;`)):(T(L,`height:${e.height}${X};width:${t()}${G};`),T(F,`min-height:100%;width:${w}px;`)),o!==void 0&&d!==void 0){for(let z=o;z<=d;(z+=1)-1)S.push({item:n()[z],index:z,style:oe(z)});if(e.onVisibleRangeUpdate){const z=A.getVisibleRange(a()===m.VERTICAL?e.height:t(),i,0);e.onVisibleRangeUpdate({type:"range.update",start:z.start,end:z.end})}}T(K,C(S))}function k(i){"scroll"in c?c.scroll({[ie[a()]]:i,behavior:v()}):c[q[a()]]=i}function j(i=0){b={},A.resetItem(i),_()}function N(i,o=r(),d=e.modelCount){return i<0?i=0:i>=d&&(i=d-1),A.getUpdatedOffsetForIndex(o,a()===m.VERTICAL?e.height:t(),f(u).offset||0,i)}const J=i=>{const o=c[q[a()]];o<0||f(u).offset===o||i.target!==c||(T(u,C({offset:o,scrollChangeReason:E.OBSERVED})),e.onAfterScroll&&e.onAfterScroll({type:"scroll.update",offset:o,event:i}))};function oe(i){if(b[i])return b[i];const{size:o,offset:d}=A.getSizeAndPositionForIndex(i);let S;return a()===m.VERTICAL?S=`left:0;width:100%;height:${o}px;position:absolute;top:${d}px;`:S=`top:0;width:${o}px;position:absolute;height:100%;left:${d}px;`,b[i]=S}var M=ye();me(M,i=>c=i,()=>c);let W;var Y=ge(M);p(Y,()=>e.header,i=>{var o=B(),d=H(o);Z(d,()=>e.header),V(i,o)});var R=$(Y,2);ce(R,21,()=>f(K),Ie,(i,o)=>{var d=B(),S=H(d),w=xe(()=>({item:f(o).item,style:f(o).style,index:e.getKey?e.getKey(f(o).index):f(o).index}));Z(S,()=>e.slot,()=>f(w)),V(i,d)}),ee(R);var ae=$(R,2);return p(ae,()=>e.footer,i=>{var o=B(),d=H(o);Z(d,()=>e.footer),V(i,o)}),ee(M),ue(()=>{W=Te(M,W,{class:`virtual-list-wrapper $${h()??""}`,style:f(L),...U},"svelte-f32i87"),ve(R,"style",f(F))}),V(s,M),Se({recomputeSizes:j})}var te=(s=>(s.AUTO="auto",s.SMOOTH="smooth",s.INSTANT="instant",s))(te||{}),y=(s=>(s.AUTO="auto",s.START="start",s.CENTER="center",s.END="end",s))(y||{}),m=(s=>(s.HORIZONTAL="horizontal",s.VERTICAL="vertical",s))(m||{}),E=(s=>(s[s.OBSERVED=0]="OBSERVED",s[s.REQUESTED=1]="REQUESTED",s))(E||{});export{y as A,m as D,te as S,Pe as V};
